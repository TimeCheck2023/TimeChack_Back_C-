CREATE DATABASE Prueba;

USE Prueba;


drop table Evento

Create Table Evento(
	id_event int not null primary key IDENTITY(1,1),
	name_event nvarchar (100) not null,
	cost_event int not null,
	date_event date default getdate(),
	location_event nvarchar (200) not null,
	description_event nvarchar (100) not null,
	capacity_event int not null,
	id_admin int not null
)

select * from Evento

drop procedure usp_insertevent

Create procedure usp_insertevent(
@name_event nvarchar(100),
@cost_event int,
@date_event datetime,
@location_event nvarchar(200),
@description_event nvarchar(100),
@capacity_event int,
@id_admin int
)
as
begin transaction AC
insert into
Evento(name_event,cost_event,date_event,location_event,description_event,capacity_event,id_admin)
values(@name_event,@cost_event,@date_event,@location_event,@description_event,@capacity_event,@id_admin)
IF @@ERROR > 0
BEGIN
ROLLBACK TRANSACTION AC
SELECT 'HUBO UN ERROR!' AS RESPUESTA
END
ELSE
BEGIN
COMMIT TRANSACTION AC
SELECT 'SE INSERTARON CORRECTAMENTE LOS DATOS!' AS RESPUESTA
END

execute usp_insertevent 'evento1',10000,'10-08-2022 09:21:40','Salon principal','evento sobre las IA',100,1

create proc usp_listevents
as
begin
select
id_event,name_event,cost_event,
date_event,location_event,description_event,capacity_event,id_admin
from Evento
end

execute usp_listevents



drop proc usp_editevents

create proc usp_editevents(
@id_event int,
@name_event nvarchar(100),
@cost_event int,
@date_event datetime,
@location_event nvarchar(200),
@description_event nvarchar(100),
@capacity_event int
)AS
BEGIN TRANSACTION AC
update Evento set
name_event = isnull(@name_event,name_event),
cost_event = isnull(@cost_event,cost_event),
date_event = isnull(@date_event,date_event),
location_event = isnull(@location_event,location_event),
description_event = ISNULL(@description_event,description_event),
capacity_event = isnull(@capacity_event,capacity_event)
where id_event = @id_event
IF @@ERROR > 0
BEGIN
ROLLBACK TRANSACTION AC
SELECT 'HUBO UN ERROR! ' AS RESPUESTA
END
ELSE
BEGIN
COMMIT TRANSACTION AC
SELECT 'SE ACTUALIZARON CORRECTAMENTE LOS DATOS!' AS RESPUESTA
END

execute usp_editevents 1,'evento 01', 20000,'10-020-2022','sadasds','sadasdas',4


create proc usp_deleteevent(
@id_event varchar(30)
)
as
BEGIN TRANSACTION AC
delete from Evento where id_event = @id_event
IF @@ERROR > 0
BEGIN
ROLLBACK TRANSACTION AC
SELECT 'HUBO UN ERROR! ' AS RESPUESTA
END
ELSE
BEGIN
COMMIT TRANSACTION AC
SELECT 'SE ELIMINARON CORRECTAMENTE LOS DATOS!' AS RESPUESTA
END

execute usp_deleteevent 1

create proc usp_consultevent(
@id_event int)
as
begin
select
id_event,name_event,cost_event,
date_event,location_event,description_event,capacity_event,id_admin
from Evento where @id_event = id_event
end

execute usp_consultevent 2
